#!/bin/bash

set -eu

dir="$(dirname $0)"
jarfile="${dir}/share/rhino-1.6R7.jar"
jsfile="${dir}/share/jslint.js"
RHINO="java -jar ${jarfile}"

## This will automagically update it's linter.
if [ "${1:-}" = '-u' ]; then
    cd "${dir}/share"
    wget -N http://www.jslint.com/rhino/jslint.js
    exit 0
fi

if [ "${1:-}" = "-p" ]; then
    PRETTY=1
    shift
else
    PRETTY=0
fi

for fname in "$@"; do
    sfname=$(basename "${fname}")
    if [ $PRETTY = 1 ]; then
        echo "jslint: linting ${fname} ***********"
        ${RHINO} \
            "${jsfile}" \
            "${fname}" \
            | perl -p \
            -e 's!^Lint at line (\d+) character (\d+):!'"lint at ${sfname}"':$1:$2 !;'
    else
        ${RHINO} \
            "${jsfile}" \
            "${fname}"
    fi
done

#EOF
